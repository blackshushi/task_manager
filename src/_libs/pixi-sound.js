!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.__pixiSound=e.__pixiSound||{})}(this,function(e){"use strict";function c(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}if("undefined"==typeof PIXI)throw"PixiJS required";var t,n,o=function(){function e(e,t){this._output=t,this._input=e}return Object.defineProperty(e.prototype,"destination",{get:function(){return this._input},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filters",{get:function(){return this._filters},set:function(e){var t=this;if(this._filters&&(this._filters.forEach(function(e){e&&e.disconnect()}),this._filters=null,this._input.connect(this._output)),e&&e.length){this._filters=e.slice(0),this._input.disconnect();var n=null;e.forEach(function(e){null===n?t._input.connect(e.destination):n.connect(e.destination),n=e}),n.connect(this._output)}},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.filters=null,this._input=null,this._output=null},e}(),i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r=0,s=function(n){function a(e){var t=n.call(this)||this;return t.id=r++,t.init(e),t}return c(a,n),Object.defineProperty(a.prototype,"progress",{get:function(){return this._source.currentTime/this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"paused",{get:function(){return this._paused},set:function(e){this._paused=e,this.refreshPaused()},enumerable:!0,configurable:!0}),a.prototype._onPlay=function(){this._playing=!0},a.prototype._onPause=function(){this._playing=!1},a.prototype.init=function(e){this._playing=!1,this._duration=e.source.duration;var t=this._source=e.source.cloneNode(!1);t.src=e.parent.url,t.onplay=this._onPlay.bind(this),t.onpause=this._onPause.bind(this),e.context.on("refresh",this.refresh,this),e.context.on("refreshPaused",this.refreshPaused,this),this._media=e},a.prototype._internalStop=function(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())},a.prototype.stop=function(){this._internalStop(),this._source&&this.emit("stop")},Object.defineProperty(a.prototype,"speed",{get:function(){return this._speed},set:function(e){this._speed=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"volume",{get:function(){return this._volume},set:function(e){this._volume=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"muted",{get:function(){return this._muted},set:function(e){this._muted=e,this.refresh()},enumerable:!0,configurable:!0}),a.prototype.refresh=function(){var e=this._media.context,t=this._media.parent;this._source.loop=this._loop||t.loop;var n=e.volume*(e.muted?0:1),o=t.volume*(t.muted?0:1),i=this._volume*(this._muted?0:1);this._source.volume=i*n*o,this._source.playbackRate=this._speed*e.speed*t.speed},a.prototype.refreshPaused=function(){var e=this._media.context,t=this._media.parent,n=this._paused||t.paused||e.paused;n!==this._pausedReal&&((this._pausedReal=n)?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",n))},a.prototype.play=function(e){var t=this,n=e.start,o=e.end,i=e.speed,r=e.loop,s=e.volume,u=e.muted;o&&console.assert(n<o,"End time is before start time"),this._speed=i,this._volume=s,this._loop=!!r,this._muted=u,this.refresh(),this.loop&&null!==o&&(console.warn('Looping not support when specifying an "end" time'),this.loop=!1),this._start=n,this._end=o||this._duration,this._start=Math.max(0,this._start-a.PADDING),this._end=Math.min(this._end+a.PADDING,this._duration),this._source.onloadedmetadata=function(){t._source&&(t._source.currentTime=n,t._source.onloadedmetadata=null,t.emit("progress",n,t._duration),PIXI.ticker.shared.add(t._onUpdate,t))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")},a.prototype._onUpdate=function(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()},a.prototype._onComplete=function(){PIXI.ticker.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)},a.prototype.destroy=function(){PIXI.ticker.shared.remove(this._onUpdate,this),this.removeAllListeners();var e=this._source;e&&(e.onended=null,e.onplay=null,e.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)},a.prototype.toString=function(){return"[HTMLAudioInstance id="+this.id+"]"},a.PADDING=.1,a}(PIXI.utils.EventEmitter),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t.prototype.init=function(e){this.parent=e,this._source=e.options.source||new Audio,e.url&&(this._source.src=e.url)},t.prototype.create=function(){return new s(this)},Object.defineProperty(t.prototype,"isPlayable",{get:function(){return!!this._source&&4===this._source.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._source.duration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this.parent.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filters",{get:function(){return null},set:function(e){console.warn("HTML Audio does not support filters")},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)},Object.defineProperty(t.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),t.prototype.load=function(t){var n=this._source,o=this.parent;if(4!==n.readyState){if(!o.url)return t(new Error("sound.url or sound.source must be set"));n.src=o.url;var i=function(){n.removeEventListener("canplaythrough",e),n.removeEventListener("load",e),n.removeEventListener("abort",r),n.removeEventListener("error",s)},e=function(){i(),o.isLoaded=!0;var e=o.autoPlayStart();t&&t(null,o,e)},r=function(){i(),t&&t(new Error("Sound loading has been aborted"))},s=function(){i();var e="Failed to load audio element (code: "+n.error.code+")";t?t(new Error(e)):console.error(e)};n.addEventListener("canplaythrough",e,!1),n.addEventListener("load",e,!1),n.addEventListener("abort",r,!1),n.addEventListener("error",s,!1),n.load()}else{o.isLoaded=!0;var u=o.autoPlayStart();t&&setTimeout(function(){t(null,o,u)},0)}},t}(PIXI.utils.EventEmitter),a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},l=(n=t={exports:{}},function(e){function o(){}function r(e){if(!(this instanceof r))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(e,this)}function i(n,o){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,r._immediateFn(function(){var e=1===n._state?o.onFulfilled:o.onRejected;if(null!==e){var t;try{t=e(n._value)}catch(e){return void u(o.promise,e)}s(o.promise,t)}else(1===n._state?s:u)(o.promise,n._value)})):n._deferreds.push(o)}function s(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof r)return e._state=3,e._value=t,void a(e);if("function"==typeof n)return void l((o=n,i=t,function(){o.apply(i,arguments)}),e)}e._state=1,e._value=t,a(e)}catch(t){u(e,t)}var o,i}function u(e,t){e._state=2,e._value=t,a(e)}function a(e){2===e._state&&0===e._deferreds.length&&r._immediateFn(function(){e._handled||r._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)i(e,e._deferreds[t]);e._deferreds=null}function c(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function l(e,t){var n=!1;try{e(function(e){n||(n=!0,s(t,e))},function(e){n||(n=!0,u(t,e))})}catch(e){if(n)return;n=!0,u(t,e)}}var t=setTimeout;r.prototype.catch=function(e){return this.then(null,e)},r.prototype.then=function(e,t){var n=new this.constructor(o);return i(this,new c(e,t,n)),n},r.all=function(t){return new r(function(o,i){function r(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void n.call(e,function(e){r(t,e)},i)}s[t]=e,0==--u&&o(s)}catch(t){i(t)}}if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var s=Array.prototype.slice.call(t);if(0===s.length)return o([]);for(var u=s.length,e=0;e<s.length;e++)r(e,s[e])})},r.resolve=function(t){return t&&"object"==typeof t&&t.constructor===r?t:new r(function(e){e(t)})},r.reject=function(n){return new r(function(e,t){t(n)})},r.race=function(i){return new r(function(e,t){for(var n=0,o=i.length;n<o;n++)i[n].then(e,t)})},r._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){t(e,0)},r._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},r._setImmediateFn=function(e){r._immediateFn=e},r._setUnhandledRejectionFn=function(e){r._unhandledRejectionFn=e},n.exports?n.exports=r:e.Promise||(e.Promise=r)}(a),t.exports),p=function(){function e(e,t){this.destination=e,this.source=t||e}return e.prototype.connect=function(e){this.source.connect(e)},e.prototype.disconnect=function(){this.source.disconnect()},e.prototype.destroy=function(){this.disconnect(),this.destination=null,this.source=null},e}(),y=function(){function e(){}return e.setParamValue=function(e,t){if(e.setValueAtTime){var n=C.instance.context;e.setValueAtTime(t,n.audioContext.currentTime)}else e.value=t;return t},e}(),h=function(f){function _(e,t,n,o,i,r,s,u,a,c){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===u&&(u=0),void 0===a&&(a=0),void 0===c&&(c=0);var l=this;if(!C.instance.useLegacy){var p=[{f:_.F32,type:"lowshelf",gain:e},{f:_.F64,type:"peaking",gain:t},{f:_.F125,type:"peaking",gain:n},{f:_.F250,type:"peaking",gain:o},{f:_.F500,type:"peaking",gain:i},{f:_.F1K,type:"peaking",gain:r},{f:_.F2K,type:"peaking",gain:s},{f:_.F4K,type:"peaking",gain:u},{f:_.F8K,type:"peaking",gain:a},{f:_.F16K,type:"highshelf",gain:c}].map(function(e){var t=C.instance.context.audioContext.createBiquadFilter();return t.type=e.type,y.setParamValue(t.gain,e.gain),y.setParamValue(t.Q,1),y.setParamValue(t.frequency,e.f),t});(l=f.call(this,p[0],p[p.length-1])||this).bands=p,l.bandsMap={};for(var h=0;h<l.bands.length;h++){var d=l.bands[h];0<h&&l.bands[h-1].connect(d),l.bandsMap[d.frequency.value]=d}return l}l=f.call(this,null)||this}return c(_,f),_.prototype.setGain=function(e,t){if(void 0===t&&(t=0),!this.bandsMap[e])throw"No band found for frequency "+e;y.setParamValue(this.bandsMap[e].gain,t)},_.prototype.getGain=function(e){if(!this.bandsMap[e])throw"No band found for frequency "+e;return this.bandsMap[e].gain.value},Object.defineProperty(_.prototype,"f32",{get:function(){return this.getGain(_.F32)},set:function(e){this.setGain(_.F32,e)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"f64",{get:function(){return this.getGain(_.F64)},set:function(e){this.setGain(_.F64,e)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"f125",{get:function(){return this.getGain(_.F125)},set:function(e){this.setGain(_.F125,e)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"f250",{get:function(){return this.getGain(_.F250)},set:function(e){this.setGain(_.F250,e)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"f500",{get:function(){return this.getGain(_.F500)},set:function(e){this.setGain(_.F500,e)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"f1k",{get:function(){return this.getGain(_.F1K)},set:function(e){this.setGain(_.F1K,e)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"f2k",{get:function(){return this.getGain(_.F2K)},set:function(e){this.setGain(_.F2K,e)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"f4k",{get:function(){return this.getGain(_.F4K)},set:function(e){this.setGain(_.F4K,e)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"f8k",{get:function(){return this.getGain(_.F8K)},set:function(e){this.setGain(_.F8K,e)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"f16k",{get:function(){return this.getGain(_.F16K)},set:function(e){this.setGain(_.F16K,e)},enumerable:!0,configurable:!0}),_.prototype.reset=function(){this.bands.forEach(function(e){y.setParamValue(e.gain,0)})},_.prototype.destroy=function(){this.bands.forEach(function(e){e.disconnect()}),this.bands=null,this.bandsMap=null},_.F32=32,_.F64=64,_.F125=125,_.F250=250,_.F500=500,_.F1K=1e3,_.F2K=2e3,_.F4K=4e3,_.F8K=8e3,_.F16K=16e3,_}(p),d=function(o){function e(e){void 0===e&&(e=0);var t=this;if(!C.instance.useLegacy){var n=C.instance.context.audioContext.createWaveShaper();return(t=o.call(this,n)||this)._distortion=n,t.amount=e,t}t=o.call(this,null)||this}return c(e,o),Object.defineProperty(e.prototype,"amount",{get:function(){return this._amount},set:function(e){e*=1e3,this._amount=e;for(var t,n=new Float32Array(44100),o=Math.PI/180,i=0;i<44100;++i)t=2*i/44100-1,n[i]=(3+e)*t*20*o/(Math.PI+e*Math.abs(t));this._distortion.curve=n,this._distortion.oversample="4x"},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._distortion=null,o.prototype.destroy.call(this)},e}(p),f=function(s){function e(e){void 0===e&&(e=0);var t=this;if(!C.instance.useLegacy){var n,o,i,r=C.instance.context.audioContext;return r.createStereoPanner?i=n=r.createStereoPanner():((o=r.createPanner()).panningModel="equalpower",i=o),(t=s.call(this,i)||this)._stereo=n,t._panner=o,t.pan=e,t}t=s.call(this,null)||this}return c(e,s),Object.defineProperty(e.prototype,"pan",{get:function(){return this._pan},set:function(e){this._pan=e,this._stereo?y.setParamValue(this._stereo.pan,e):this._panner.setPosition(e,0,1-Math.abs(e))},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){s.prototype.destroy.call(this),this._stereo=null,this._panner=null},e}(p),_=function(r){function e(e,t,n){void 0===e&&(e=3),void 0===t&&(t=2),void 0===n&&(n=!1);var o=this;if(!C.instance.useLegacy){var i=C.instance.context.audioContext.createConvolver();return(o=r.call(this,i)||this)._convolver=i,o._seconds=o._clamp(e,1,50),o._decay=o._clamp(t,0,100),o._reverse=n,o._rebuild(),o}o=r.call(this,null)||this}return c(e,r),e.prototype._clamp=function(e,t,n){return Math.min(n,Math.max(t,e))},Object.defineProperty(e.prototype,"seconds",{get:function(){return this._seconds},set:function(e){this._seconds=this._clamp(e,1,50),this._rebuild()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"decay",{get:function(){return this._decay},set:function(e){this._decay=this._clamp(e,0,100),this._rebuild()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reverse",{get:function(){return this._reverse},set:function(e){this._reverse=e,this._rebuild()},enumerable:!0,configurable:!0}),e.prototype._rebuild=function(){for(var e,t=C.instance.context.audioContext,n=t.sampleRate,o=n*this._seconds,i=t.createBuffer(2,o,n),r=i.getChannelData(0),s=i.getChannelData(1),u=0;u<o;u++)e=this._reverse?o-u:u,r[u]=(2*Math.random()-1)*Math.pow(1-e/o,this._decay),s[u]=(2*Math.random()-1)*Math.pow(1-e/o,this._decay);this._convolver.buffer=i},e.prototype.destroy=function(){this._convolver=null,r.prototype.destroy.call(this)},e}(p),m=function(i){function e(){var e=this;C.instance.useLegacy&&(e=i.call(this,null)||this);var t=C.instance.context.audioContext,n=t.createChannelSplitter(),o=t.createChannelMerger();return o.connect(n),(e=i.call(this,o,n)||this)._merger=o,e}return c(e,i),e.prototype.destroy=function(){this._merger.disconnect(),this._merger=null,i.prototype.destroy.call(this)},e}(p),b=function(r){function e(){if(!C.instance.useLegacy){var e=C.instance.context.audioContext,t=e.createBiquadFilter(),n=e.createBiquadFilter(),o=e.createBiquadFilter(),i=e.createBiquadFilter();return t.type="lowpass",y.setParamValue(t.frequency,2e3),n.type="lowpass",y.setParamValue(n.frequency,2e3),o.type="highpass",y.setParamValue(o.frequency,500),i.type="highpass",y.setParamValue(i.frequency,500),t.connect(n),n.connect(o),o.connect(i),r.call(this,t,i)||this}r.call(this,null)}return c(e,r),e}(p),g=Object.freeze({Filter:p,EqualizerFilter:h,DistortionFilter:d,StereoFilter:f,ReverbFilter:_,MonoFilter:m,TelephoneFilter:b}),v=function(t){function e(){var e=t.call(this)||this;return e.speed=1,e.volume=1,e.muted=!1,e.paused=!1,e}return c(e,t),e.prototype.refresh=function(){this.emit("refresh")},e.prototype.refreshPaused=function(){this.emit("refreshPaused")},Object.defineProperty(e.prototype,"filters",{get:function(){return console.warn("HTML Audio does not support filters"),null},set:function(e){console.warn("HTML Audio does not support filters")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioContext",{get:function(){return console.warn("HTML Audio does not support audioContext"),null},enumerable:!0,configurable:!0}),e.prototype.toggleMute=function(){return this.muted=!this.muted,this.refresh(),this.muted},e.prototype.togglePause=function(){return this.paused=!this.paused,this.refreshPaused(),this.paused},e.prototype.destroy=function(){this.removeAllListeners()},e}(PIXI.utils.EventEmitter),P=Object.freeze({HTMLAudioMedia:u,HTMLAudioInstance:s,HTMLAudioContext:v}),x=0,O=function(n){function e(e){var t=n.call(this)||this;return t.id=x++,t._media=null,t._paused=!1,t._muted=!1,t._elapsed=0,t._updateListener=t._update.bind(t),t.init(e),t}return c(e,n),e.prototype.stop=function(){this._source&&(this._internalStop(),this.emit("stop"))},Object.defineProperty(e.prototype,"speed",{get:function(){return this._speed},set:function(e){this._speed=e,this.refresh(),this._update(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){this._volume=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._muted},set:function(e){this._muted=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e,this.refresh()},enumerable:!0,configurable:!0}),e.prototype.refresh=function(){var e=this._media.context,t=this._media.parent;this._source.loop=this._loop||t.loop;var n=e.volume*(e.muted?0:1),o=t.volume*(t.muted?0:1),i=this._volume*(this._muted?0:1);y.setParamValue(this._gain.gain,i*o*n),y.setParamValue(this._source.playbackRate,this._speed*t.speed*e.speed)},e.prototype.refreshPaused=function(){var e=this._media.context,t=this._media.parent,n=this._paused||t.paused||e.paused;n!==this._pausedReal&&((this._pausedReal=n)?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",n))},e.prototype.play=function(e){var t=e.start,n=e.end,o=e.speed,i=e.loop,r=e.volume,s=e.muted;n&&console.assert(t<n,"End time is before start time"),this._paused=!1;var u=this._media.nodes.cloneBufferSource(),a=u.source,c=u.gain;this._source=a,this._gain=c,this._speed=o,this._volume=r,this._loop=!!i,this._muted=s,this.refresh(),this.loop&&null!==n&&(console.warn('Looping not support when specifying an "end" time'),this.loop=!1),this._end=n;var l=this._source.buffer.duration;this._duration=l,this._lastUpdate=this._now(),this._elapsed=t,this._source.onended=this._onComplete.bind(this),n?this._source.start(0,t,n-t):this._source.start(0,t),this.emit("start"),this._update(!0),this._enabled=!0},e.prototype._toSec=function(e){return 10<e&&(e/=1e3),e||0},Object.defineProperty(e.prototype,"_enabled",{set:function(e){var t=this._media.nodes.script;t.removeEventListener("audioprocess",this._updateListener),e&&t.addEventListener("audioprocess",this._updateListener)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"progress",{get:function(){return this._progress},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},set:function(e){this._paused=e,this.refreshPaused()},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.removeAllListeners(),this._internalStop(),this._source&&(this._source.disconnect(),this._source=null),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1},e.prototype.toString=function(){return"[WebAudioInstance id="+this.id+"]"},e.prototype._now=function(){return this._media.context.audioContext.currentTime},e.prototype._update=function(e){if(void 0===e&&(e=!1),this._source){var t=this._now(),n=t-this._lastUpdate;if(0<n||e){var o=this._source.playbackRate.value;this._elapsed+=n*o,this._lastUpdate=t;var i=this._duration,r=this._elapsed%i/i;this._progress=r,this.emit("progress",this._progress,i)}}},e.prototype.init=function(e){(this._media=e).context.events.on("refresh",this.refresh,this),e.context.events.on("refreshPaused",this.refreshPaused,this)},e.prototype._internalStop=function(){this._source&&(this._enabled=!1,this._source.onended=null,this._source.stop(0),this._source=null)},e.prototype._onComplete=function(){this._source&&(this._enabled=!1,this._source.onended=null),this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)},e}(PIXI.utils.EventEmitter),w=function(u){function a(e){var t=this,n=e.audioContext,o=n.createBufferSource(),i=n.createScriptProcessor(a.BUFFER_SIZE),r=n.createGain(),s=n.createAnalyser();return o.connect(s),s.connect(r),r.connect(e.destination),i.connect(e.destination),(t=u.call(this,s,r)||this).context=e,t.bufferSource=o,t.script=i,t.gain=r,t.analyser=s,t}return c(a,u),a.prototype.destroy=function(){u.prototype.destroy.call(this),this.bufferSource.disconnect(),this.script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this.script=null,this.gain=null,this.analyser=null,this.context=null},a.prototype.cloneBufferSource=function(){var e=this.bufferSource,t=this.context.audioContext.createBufferSource();t.buffer=e.buffer,y.setParamValue(t.playbackRate,e.playbackRate.value),t.loop=e.loop;var n=this.context.audioContext.createGain();return t.connect(n),n.connect(this.destination),{source:t,gain:n}},a.BUFFER_SIZE=256,a}(o),j=function(){function e(){}return e.prototype.init=function(e){this.parent=e,this._nodes=new w(this.context),this._source=this._nodes.bufferSource,this.source=e.options.source},e.prototype.destroy=function(){this.parent=null,this._nodes.destroy(),this._nodes=null,this._source=null,this.source=null},e.prototype.create=function(){return new O(this)},Object.defineProperty(e.prototype,"context",{get:function(){return this.parent.context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPlayable",{get:function(){return!!this._source&&!!this._source.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filters",{get:function(){return this._nodes.filters},set:function(e){this._nodes.filters=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return console.assert(this.isPlayable,"Sound not yet playable, no duration"),this._source.buffer.duration},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffer",{get:function(){return this._source.buffer},set:function(e){this._source.buffer=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodes",{get:function(){return this._nodes},enumerable:!0,configurable:!0}),e.prototype.load=function(e){this.source?this._decode(this.source,e):this.parent.url?this._loadUrl(e):e?e(new Error("sound.url or sound.source must be set")):console.error("sound.url or sound.source must be set")},e.prototype._loadUrl=function(e){var t=this,n=new XMLHttpRequest,o=this.parent.url;n.open("GET",o,!0),n.responseType="arraybuffer",n.onload=function(){t.source=n.response,t._decode(n.response,e)},n.send()},e.prototype._decode=function(e,o){var i=this;this.parent.context.decode(e,function(e,t){if(e)o&&o(e);else{i.parent.isLoaded=!0,i.buffer=t;var n=i.parent.autoPlayStart();o&&o(null,i.parent,n)}})},e}(),A=function(){function l(){}return l.resolveUrl=function(e){var t=l.FORMAT_PATTERN,n="string"==typeof e?e:e.url;if(t.test(n)){for(var o=t.exec(n),i=o[2].split(","),r=i[i.length-1],s=0,u=i.length;s<u;s++){var a=i[s];if(l.supported[a]){r=a;break}}var c=n.replace(o[1],r);return"string"!=typeof e&&(e.extension=r,e.url=c),c}return n},l.sineTone=function(e,t){void 0===e&&(e=200),void 0===t&&(t=1);var n=M.from({singleInstance:!0});if(!(n.media instanceof j))return n;for(var o=n.media,i=n.context.audioContext.createBuffer(1,48e3*t,48e3),r=i.getChannelData(0),s=0;s<r.length;s++){var u=e*(s/i.sampleRate)*Math.PI;r[s]=2*Math.sin(u)}return o.buffer=i,n.isLoaded=!0,n},l.render=function(e,t){var n=document.createElement("canvas");t=Object.assign({width:512,height:128,fill:"black"},t||{}),n.width=t.width,n.height=t.height;var o=PIXI.BaseTexture.fromCanvas(n);if(!(e.media instanceof j))return o;var i=e.media;console.assert(!!i.buffer,"No buffer found, load first");var r=n.getContext("2d");r.fillStyle=t.fill;for(var s=i.buffer.getChannelData(0),u=Math.ceil(s.length/t.width),a=t.height/2,c=0;c<t.width;c++){for(var l=1,p=-1,h=0;h<u;h++){var d=s[c*u+h];d<l&&(l=d),p<d&&(p=d)}r.fillRect(c,(1+l)*a,1,Math.max(1,(p-l)*a))}return o},l.playOnce=function(e,t){var n="alias"+l.PLAY_ID++;return C.instance.add(n,{url:e,preload:!0,autoPlay:!0,loaded:function(e){e&&(console.error(e),C.instance.remove(n),t&&t(e))},complete:function(){C.instance.remove(n),t&&t(null)}}),n},l.PLAY_ID=0,l.FORMAT_PATTERN=/\.(\{([^\}]+)\})(\?.*)?$/,l.extensions=["mp3","ogg","oga","opus","mpeg","wav","m4a","mp4","aiff","wma","mid"],l.supported=(i={m4a:"mp4",oga:"ogg"},r=document.createElement("audio"),s={},l.extensions.forEach(function(e){var t=i[e]||e,n=r.canPlayType("audio/"+e).replace(/^no$/,""),o=r.canPlayType("audio/"+t).replace(/^no$/,"");s[e]=!!n||!!o}),Object.freeze(s)),l;var i,r,s}(),F=function(o){function e(e,t){var n=o.call(this,e,t)||this;return n.use(E.plugin),n.pre(E.resolve),n}return c(e,o),e.addPixiMiddleware=function(e){o.addPixiMiddleware.call(this,e)},e}(PIXI.loaders.Loader),E=function(){function n(){}return n.install=function(e){n._sound=e,n.legacy=e.useLegacy,PIXI.loaders.Loader=F,PIXI.loader.use(n.plugin),PIXI.loader.pre(n.resolve)},Object.defineProperty(n,"legacy",{set:function(e){var t=PIXI.loaders.Resource,n=A.extensions;e?n.forEach(function(e){t.setExtensionXhrType(e,t.XHR_RESPONSE_TYPE.DEFAULT),t.setExtensionLoadType(e,t.LOAD_TYPE.AUDIO)}):n.forEach(function(e){t.setExtensionXhrType(e,t.XHR_RESPONSE_TYPE.BUFFER),t.setExtensionLoadType(e,t.LOAD_TYPE.XHR)})},enumerable:!0,configurable:!0}),n.resolve=function(e,t){A.resolveUrl(e),t()},n.plugin=function(e,t){e.data&&-1<A.extensions.indexOf(e.extension)?e.sound=n._sound.add(e.name,{loaded:t,preload:!0,url:e.url,source:e.data}):t()},n}(),L=function(){function e(e,t){this.parent=e,Object.assign(this,t),this.duration=this.end-this.start,console.assert(0<this.duration,"End time must be after start time")}return e.prototype.play=function(e){return this.parent.play(Object.assign({complete:e,speed:this.speed||this.parent.speed,end:this.end,start:this.start}))},e.prototype.destroy=function(){this.parent=null},e}(),S=function(i){function r(){var e=this,t=new r.AudioContext,n=t.createDynamicsCompressor(),o=t.createAnalyser();return o.connect(n),n.connect(t.destination),(e=i.call(this,o,n)||this)._ctx=t,e._offlineCtx=new r.OfflineAudioContext(1,2,t.sampleRate),e._unlocked=!1,e.compressor=n,e.analyser=o,e.events=new PIXI.utils.EventEmitter,e.volume=1,e.speed=1,e.muted=!1,e.paused=!1,"running"!==t.state&&(e._unlock(),e._unlock=e._unlock.bind(e),document.addEventListener("mousedown",e._unlock,!0),document.addEventListener("touchstart",e._unlock,!0),document.addEventListener("touchend",e._unlock,!0)),e}return c(r,i),r.prototype._unlock=function(){this._unlocked||(this.playEmptySound(),"running"===this._ctx.state&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._unlocked=!0))},r.prototype.playEmptySound=function(){var e=this._ctx.createBufferSource();e.buffer=this._ctx.createBuffer(1,1,22050),e.connect(this._ctx.destination),e.start(0,0,0),"suspended"===e.context.state&&e.context.resume()},Object.defineProperty(r,"AudioContext",{get:function(){var e=window;return e.AudioContext||e.webkitAudioContext||null},enumerable:!0,configurable:!0}),Object.defineProperty(r,"OfflineAudioContext",{get:function(){var e=window;return e.OfflineAudioContext||e.webkitOfflineAudioContext||null},enumerable:!0,configurable:!0}),r.prototype.destroy=function(){i.prototype.destroy.call(this);var e=this._ctx;void 0!==e.close&&e.close(),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null},Object.defineProperty(r.prototype,"audioContext",{get:function(){return this._ctx},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"offlineContext",{get:function(){return this._offlineCtx},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paused",{get:function(){return this._paused},set:function(e){e&&"running"===this._ctx.state?this._ctx.suspend():e||"suspended"!==this._ctx.state||this._ctx.resume(),this._paused=e},enumerable:!0,configurable:!0}),r.prototype.refresh=function(){this.events.emit("refresh")},r.prototype.refreshPaused=function(){this.events.emit("refreshPaused")},r.prototype.toggleMute=function(){return this.muted=!this.muted,this.refresh(),this.muted},r.prototype.togglePause=function(){return this.paused=!this.paused,this.refreshPaused(),this._paused},r.prototype.decode=function(e,t){this._offlineCtx.decodeAudioData(e,function(e){t(null,e)},function(){t(new Error("Unable to decode file"))})},r}(o),I=Object.freeze({WebAudioMedia:j,WebAudioInstance:O,WebAudioNodes:w,WebAudioContext:S,WebAudioUtils:y}),C=function(){function n(){this.init()}return n.prototype.init=function(){return this.supported&&(this._webAudioContext=new S),this._htmlAudioContext=new v,this._sounds={},this.useLegacy=!this.supported,this},Object.defineProperty(n.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),n.init=function(){if(n.instance)throw new Error("SoundLibrary is already created");var e=n.instance=new n;"undefined"==typeof Promise&&(window.Promise=l),void 0!==PIXI.loaders&&E.install(e),void 0===window.__pixiSound&&delete window.__pixiSound;var t=PIXI;return t.sound||(Object.defineProperty(t,"sound",{get:function(){return e}}),Object.defineProperties(e,{filters:{get:function(){return g}},htmlaudio:{get:function(){return P}},webaudio:{get:function(){return I}},utils:{get:function(){return A}},Sound:{get:function(){return M}},SoundSprite:{get:function(){return L}},Filterable:{get:function(){return o}},SoundLibrary:{get:function(){return n}}})),e},Object.defineProperty(n.prototype,"filtersAll",{get:function(){return this.useLegacy?[]:this._context.filters},set:function(e){this.useLegacy||(this._context.filters=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"supported",{get:function(){return null!==S.AudioContext},enumerable:!0,configurable:!0}),n.prototype.add=function(e,t){if("object"==typeof e){var n={};for(var o in e)i=this._getOptions(e[o],t),n[o]=this.add(o,i);return n}if("string"==typeof e){if(console.assert(!this._sounds[e],"Sound with alias "+e+" already exists."),t instanceof M)return this._sounds[e]=t;var i=this._getOptions(t),r=M.from(i);return this._sounds[e]=r}},n.prototype._getOptions=function(e,t){var n;return n="string"==typeof e?{url:e}:e instanceof ArrayBuffer||e instanceof HTMLAudioElement?{source:e}:e,Object.assign(n,t||{})},Object.defineProperty(n.prototype,"useLegacy",{get:function(){return this._useLegacy},set:function(e){E.legacy=e,!(this._useLegacy=e)&&this.supported?this._context=this._webAudioContext:this._context=this._htmlAudioContext},enumerable:!0,configurable:!0}),n.prototype.remove=function(e){return this.exists(e,!0),this._sounds[e].destroy(),delete this._sounds[e],this},Object.defineProperty(n.prototype,"volumeAll",{get:function(){return this._context.volume},set:function(e){this._context.volume=e,this._context.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"speedAll",{get:function(){return this._context.speed},set:function(e){this._context.speed=e,this._context.refresh()},enumerable:!0,configurable:!0}),n.prototype.togglePauseAll=function(){return this._context.togglePause()},n.prototype.pauseAll=function(){return this._context.paused=!0,this._context.refresh(),this},n.prototype.resumeAll=function(){return this._context.paused=!1,this._context.refresh(),this},n.prototype.toggleMuteAll=function(){return this._context.toggleMute()},n.prototype.muteAll=function(){return this._context.muted=!0,this._context.refresh(),this},n.prototype.unmuteAll=function(){return this._context.muted=!1,this._context.refresh(),this},n.prototype.removeAll=function(){for(var e in this._sounds)this._sounds[e].destroy(),delete this._sounds[e];return this},n.prototype.stopAll=function(){for(var e in this._sounds)this._sounds[e].stop();return this},n.prototype.exists=function(e,t){void 0===t&&(t=!1);var n=!!this._sounds[e];return t&&console.assert(n,"No sound matching alias '"+e+"'."),n},n.prototype.find=function(e){return this.exists(e,!0),this._sounds[e]},n.prototype.play=function(e,t){return this.find(e).play(t)},n.prototype.stop=function(e){return this.find(e).stop()},n.prototype.pause=function(e){return this.find(e).pause()},n.prototype.resume=function(e){return this.find(e).resume()},n.prototype.volume=function(e,t){var n=this.find(e);return void 0!==t&&(n.volume=t),n.volume},n.prototype.speed=function(e,t){var n=this.find(e);return void 0!==t&&(n.speed=t),n.speed},n.prototype.duration=function(e){return this.find(e).duration},n.prototype.close=function(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this},n}(),M=function(){function n(e,t){this.media=e,this.options=t,this._instances=[],this._sprites={},this.media.init(this);var n=t.complete;this._autoPlayOptions=n?{complete:n}:null,this.isLoaded=!1,this.isPlaying=!1,this.autoPlay=t.autoPlay,this.singleInstance=t.singleInstance,this.preload=t.preload||this.autoPlay,this.url=t.url,this.speed=t.speed,this.volume=t.volume,this.loop=t.loop,t.sprites&&this.addSprites(t.sprites),this.preload&&this._preload(t.loaded)}return n.from=function(e){var t={};return"string"==typeof e?t.url=e:e instanceof ArrayBuffer||e instanceof HTMLAudioElement?t.source=e:t=e,(t=Object.assign({autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1},t)).url&&(t.url=A.resolveUrl(t.url)),Object.freeze(t),new n(C.instance.useLegacy?new u:new j,t)},Object.defineProperty(n.prototype,"context",{get:function(){return C.instance.context},enumerable:!0,configurable:!0}),n.prototype.pause=function(){return this.isPlaying=!1,this.paused=!0,this},n.prototype.resume=function(){return this.isPlaying=0<this._instances.length,this.paused=!1,this},Object.defineProperty(n.prototype,"paused",{get:function(){return this._paused},set:function(e){this._paused=e,this.refreshPaused()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"speed",{get:function(){return this._speed},set:function(e){this._speed=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"filters",{get:function(){return this.media.filters},set:function(e){this.media.filters=e},enumerable:!0,configurable:!0}),n.prototype.addSprites=function(e,t){if("object"==typeof e){var n={};for(var o in e)n[o]=this.addSprites(o,e[o]);return n}if("string"==typeof e){console.assert(!this._sprites[e],"Alias "+e+" is already taken");var i=new L(this,t);return this._sprites[e]=i}},n.prototype.destroy=function(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null},n.prototype.removeSprites=function(e){if(e){var t=this._sprites[e];void 0!==t&&(t.destroy(),delete this._sprites[e])}else for(var n in this._sprites)this.removeSprites(n);return this},Object.defineProperty(n.prototype,"isPlayable",{get:function(){return this.isLoaded&&this.media&&this.media.isPlayable},enumerable:!0,configurable:!0}),n.prototype.stop=function(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(var e=this._instances.length-1;0<=e;e--)this._instances[e].stop();return this},n.prototype.play=function(e,t){var r,n=this;if("string"==typeof e?r={sprite:i=e,complete:t}:"function"==typeof e?(r={}).complete=e:r=e,(r=Object.assign({complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1},r||{})).sprite){var o=r.sprite;console.assert(!!this._sprites[o],"Alias "+o+" is not available");var i=this._sprites[o];r.start=i.start,r.end=i.end,r.speed=i.speed||1,delete r.sprite}if(r.offset&&(r.start=r.offset),!this.isLoaded)return new Promise(function(o,i){n.autoPlay=!0,n._autoPlayOptions=r,n._preload(function(e,t,n){e?i(e):(r.loaded&&r.loaded(e,t,n),o(n))})});this.singleInstance&&this._removeInstances();var s=this._createInstance();return this._instances.push(s),this.isPlaying=!0,s.once("end",function(){r.complete&&r.complete(n),n._onComplete(s)}),s.once("stop",function(){n._onComplete(s)}),s.play(r),s},n.prototype.refresh=function(){for(var e=this._instances.length,t=0;t<e;t++)this._instances[t].refresh()},n.prototype.refreshPaused=function(){for(var e=this._instances.length,t=0;t<e;t++)this._instances[t].refreshPaused()},Object.defineProperty(n.prototype,"volume",{get:function(){return this._volume},set:function(e){this._volume=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"muted",{get:function(){return this._muted},set:function(e){this._muted=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e,this.refresh()},enumerable:!0,configurable:!0}),n.prototype._preload=function(e){this.media.load(e)},Object.defineProperty(n.prototype,"instances",{get:function(){return this._instances},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"sprites",{get:function(){return this._sprites},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){return this.media.duration},enumerable:!0,configurable:!0}),n.prototype.autoPlayStart=function(){var e;return this.autoPlay&&(e=this.play(this._autoPlayOptions)),e},n.prototype._removeInstances=function(){for(var e=this._instances.length-1;0<=e;e--)this._poolInstance(this._instances[e]);this._instances.length=0},n.prototype._onComplete=function(e){if(this._instances){var t=this._instances.indexOf(e);-1<t&&this._instances.splice(t,1),this.isPlaying=0<this._instances.length}this._poolInstance(e)},n.prototype._createInstance=function(){if(0<n._pool.length){var e=n._pool.pop();return e.init(this.media),e}return this.media.create()},n.prototype._poolInstance=function(e){e.destroy(),n._pool.indexOf(e)<0&&n._pool.push(e)},n._pool=[],n}(),T=C.init();e.sound=T,e.filters=g,e.htmlaudio=P,e.webaudio=I,e.Filterable=o,e.Sound=M,e.SoundLibrary=C,e.SoundSprite=L,e.utils=A,Object.defineProperty(e,"__esModule",{value:!0})});